---
title: 运行环境入门
icon: ri:java-line
createTime: 2026/02/04 20:57:19
permalink: /guide/ji-chu-zhi-shi-xue-xi/yun-xing-huan-jing-ru-men/
foo: foo
tags:
    - Java
    - 软件
    - 硬件
    - 服务器
    - 服务器核心
---
本篇教程是基础知识学习的第一篇, 之所以被放在第一篇, 是因为它是所有Minecraft服务器的**核心因素**, 没有它的话, 你就启动不了你的Minecraft服务器。

不仅如此, 这篇教程还涵盖了几乎所有的基础知识, 也就是"~~听君一席话, 白读十年书~~"。

## 1. 什么是运行环境？

### 1.1 基本概念

**运行环境**(Runtime Environment)是指==让Minecraft服务器能够正常启动和运行所需的所有软硬件条件的总和==。就像人需要空气、水和食物才能生存一样, Minecraft服务器也需要特定的"生存条件"。

### 1.2 运行环境的组成部分

Minecraft服务器的运行环境主要包括:

**软件层面:**

- ::ri:java-fill::Java运行时环境(JRE/JDK)
- ::ix:operating-system::操作系统(Windows/Linux/macOS)
- ::bi:filetype-java::服务器核心程序(Server JAR文件)
- ::fluent:library-20-filled::必要的系统依赖库

**硬件层面:**
- ::solar:cpu-bold::CPU(处理器)
- ::hugeicons:ram-memory::RAM(内存)
- ::icon-park-solid:hard-disk::存储空间(硬盘/SSD)
- ::material-symbols:wifi-rounded::网络带宽

**网络层面:**
- ::mdi:ip::公网IP地址
- ::ant-design:export-outlined::端口开放配置
- ::hugeicons:firewall::防火墙设置

::: info 为什么运行环境如此重要?

一个配置不当的运行环境会导致:
- 服务器无法启动
- 频繁崩溃或卡顿
- 玩家连接困难
- 性能严重下降
- 数据丢失风险
:::

## 2. Java运行环境详解

### 2.1 为什么Minecraft需要Java?

Minecraft Java版服务器是用Java语言编写的程序, 因此必须在Java虚拟机(JVM)上运行。这就像一个翻译官, 将Java代码翻译成计算机能够理解的指令。

### 2.2 Java版本选择指南

不同的Minecraft版本需要不同的Java版本:

| Minecraft版本 | 推荐Java版本 | 最低Java版本 |
|--------------|------------|------------|
| 1.7.10及更早 | Java 8 | Java 7 |
| 1.8 - 1.16.5 | Java 8/11 | Java 8 |
| 1.17 - 1.17.1 | Java 16 | Java 16 |
| 1.18 - 1.20.4 | Java 17 | Java 17 |
| 1.20.5 - 1.21.11 | Java 21 (x64) | Java 21 (x64) |
| 26.1及更新 | Java 25 (x64) | Java 25 (x64) |

::: tip
如果不确定该用哪个版本,选择与你的Minecraft版本对应的**最低要求版本**即可。
:::

### 2.3 JRE vs JDK 的区别

:::: card-grid
::: card title="JRE(Java Runtime Environment - Java运行时环境):"
- 只能运行Java程序
- 体积较小(约80-150MB)
- **适合仅运行服务器的用户**
:::
::: card title="JDK(Java Development Kit - Java开发工具包):"
- 包含JRE的所有功能
- 额外包含开发工具
- 体积较大(约300-500MB)
- 适合需要编译插件或MOD的用户
:::
::::

::: note 新手建议
普通服主只需下载JRE即可。
:::

### 2.4 如何下载和安装Java

#### Windows系统:

**方法一:官方渠道(推荐)**

1. 访问Oracle官网: [https://www.oracle.com/java/technologies/downloads/](https://www.oracle.com/java/technologies/downloads/)
2. 选择对应版本(如Java 17)
3. 下载Windows版本的安装程序(.exe文件)
4. 双击运行安装程序, 一路"下一步"即可(安装路径可以自行决定)

**方法二:OpenJDK(免费开源)**

1. 访问Adoptium官网: [https://adoptium.net/](https://adoptium.net/)
2. 选择对应版本
3. 下载JRE版本
4. 解压到指定文件夹(如 `D:\Java\jre-17`)

#### Linux系统:

```bash
# Ubuntu/Debian系统
sudo apt update
sudo apt install openjdk-17-jre

# CentOS/RHEL系统
sudo yum install java-17-openjdk

# 验证安装
java -version
```

#### macOS系统:

```bash
# 使用Homebrew安装
brew install openjdk@17

# 验证安装
java -version
```

### 2.5 配置Java环境变量

::: info 为什么需要配置环境变量?
环境变量让系统能够在任何位置找到Java程序, 这样你在命令行输入`java`命令时,系统就知道去哪里找这个程序。
:::

#### Windows配置步骤:

1. 右键"此电脑" → "属性" → "高级系统设置"
2. 点击"环境变量"
3. 在"系统变量"中找到`Path`, 点击"编辑"
4. 点击"新建", 添加Java安装路径(如 `D:\Program Files\Java\jdk-17\bin`)
5. 点击"确定"保存

**验证配置:**

打开命令提示符(CMD),输入:
```bash
java -version
```

如果显示Java版本信息,则配置成功。

#### Linux/macOS配置:

编辑 `~/.bashrc` 或 `~/.zshrc` 文件:

```bash
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
export PATH=$PATH:$JAVA_HOME/bin
```

保存后执行:
```bash
source ~/.bashrc
```

### 2.6 JVM参数优化基础

JVM参数控制Java虚拟机的运行方式, 合理配置可以显著提升服务器性能。

**基础启动命令:**

```bash
java -Xmx2G -Xms2G -jar server.jar nogui
```

**常用参数解释:**

- `-Xmx2G`: 设置最大内存为2GB
- `-Xms2G`: 设置初始内存为2GB
- `-jar server.jar`: 指定要运行的服务器文件
- `nogui`: 不启动图形界面(节省资源)

::: tip
`Xmx`和`Xms`设置为相同值可以减少内存分配的开销,提升性能。
:::

**进阶优化参数(适用于Java 17+):**

```bash
java -Xmx4G -Xms4G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:+PerfDisableSharedMem -XX:MaxTenuringThreshold=1 -Dusing.aikars.flags=https://mcflags.emc.gs -Daikars.new.flags=true -jar server.jar nogui
```

::: note 新手建议
刚开始只需要设置`-Xmx`和`-Xms`即可,高级参数等熟悉后再使用。
:::

## 3. 操作系统环境

### 3.1 操作系统选择

#### Windows Server / Windows 10/11

**优点:**
- 图形界面友好,易于操作
- 适合初学者
- 插件和MOD兼容性好
- 本地测试方便

**缺点:**
- 资源占用较高(系统本身需要2-4GB内存)
- 性能不如Linux
- 许可证费用(Server版本)

**适用场景:** 个人测试服、小型朋友服(10人以下)

#### Linux (Ubuntu/Debian/CentOS)

**优点:**
- 资源占用极低
- 性能优异
- 稳定性强
- 免费开源
- 云服务器标配

**缺点:**
- 学习曲线陡峭
- 纯命令行操作
- 需要一定技术基础

**适用场景:** 公开服务器、大型服务器、生产环境

::: tip 推荐版本
- **Ubuntu 22.04 LTS** (最流行,文档丰富)
- **Debian 12** (稳定性极佳)
- **CentOS Stream** (企业级稳定)
:::

#### macOS

**特点:**
- 主要用于本地开发测试
- 不推荐用于生产服务器

### 3.2 系统要求

**最低要求:**
- 64位操作系统
- 支持Java 17+
- 至少2GB可用内存
- 10GB可用存储空间

**推荐配置:**
- 最新版本的64位系统
- 定期安全更新
- 纯净系统(最小化安装不必要软件)

### 3.3 系统优化建议

#### Windows优化:

1. **关闭不必要的服务:**
   - Windows搜索
   - Windows Defender(如有其他杀毒软件)
   - 自动更新(改为手动)

2. **性能设置:**
   - 调整为"最佳性能"模式
   - 关闭视觉效果
   - 禁用系统还原(可选)

3. **防火墙配置:**
   - 允许Java通过防火墙
   - 开放服务器端口(默认25565)

#### Linux优化:

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装必要工具
sudo apt install screen wget curl -y

# 优化系统参数(编辑/etc/sysctl.conf)
sudo nano /etc/sysctl.conf

# 添加以下内容:
# 网络优化
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864

# 应用设置
sudo sysctl -p
```

## 4. 硬件环境要求

### 4.1 CPU(处理器)

**Minecraft服务器的特点:** 主要依赖单核性能,而非多核数量。

**性能指标:**

| 服务器规模 | CPU要求 | 推荐型号示例 |
|----------|--------|------------|
| 小型(1-10人) | 双核 3.0GHz+ | Intel i3 10代+ / AMD Ryzen 3 |
| 中型(10-50人) | 四核 3.5GHz+ | Intel i5 12代+ / AMD Ryzen 5 |
| 大型(50-100人) | 六核 4.0GHz+ | Intel i7 12代+ / AMD Ryzen 7 |
| 超大型(100+人) | 八核 4.5GHz+ | Intel i9 / AMD Ryzen 9 / Xeon |

::: tip 关键点
高主频比多核心更重要! 一个4核心4.5GHz的CPU比8核心2.5GHz的CPU更适合MC服务器。
:::

### 4.2 内存(RAM)

**内存分配原则:**

**基础计算公式:**
```
服务器所需内存 = 系统占用 + MC基础内存 + 插件/MOD内存 + 玩家内存 + 缓冲

- 系统占用: Windows 2-4GB, Linux 0.5-1GB
- MC基础内存: 1-2GB(原版)
- 插件/MOD: 每10个插件约500MB, 大型MOD包2-8GB
- 玩家内存: 每个在线玩家约50-100MB
- 缓冲: 建议预留20-30%
```

**具体配置建议:**

| 服务器类型 | 总内存需求 | 分配给MC | 适用场景 |
|----------|----------|---------|---------|
| 原版小服 | 4GB | 2GB | 1-5人,无插件 |
| 插件轻量服 | 6GB | 4GB | 5-20人,少量插件 |
| 插件中型服 | 8GB | 6GB | 20-50人,常规插件 |
| 大型插件服 | 16GB | 12GB | 50-100人,大量插件 |
| 小型MOD包 | 8GB | 6GB | 1-10人,50个MOD以内 |
| 大型MOD包 | 16GB+ | 12GB+ | 1-20人,100+个MOD |
| 超大型服务器 | 32GB+ | 24GB+ | 100+人或超大地图 |

::: warning
1. 不要把所有内存都分配给MC, 要给系统留足够的空间
2. 32位系统最多支持4GB内存, 必须使用64位系统
3. 建议使用DDR4或DDR5内存, 频率越高越好
:::

### 4.3 存储空间

**硬盘类型对比:**

:::: card-grid
::: card title="HDD(机械硬盘):"
- 读写速度: 80-160MB/s
- 优点: 容量大, 价格便宜
- 缺点: 速度慢, 会造成卡顿
- **适用:** 仅用于备份存储
:::
::: card title="SSD(固态硬盘):"
- 读写速度: 500-3500MB/s
- 优点: 速度快, 几乎无卡顿
- 缺点: 价格较贵
- **强烈推荐用于服务器主存储**
:::
::: card title="NVMe SSD:"
- 读写速度: 3000-7000MB/s
- 最佳选择, 性能极致
:::
::::

**空间需求:**

| 内容类型 | 空间占用 |
|---------|---------|
| 服务器核心文件 | 100-500MB |
| 原版世界(新建) | 500MB-2GB |
| 原版世界(运行1月) | 2-5GB |
| 原版世界(运行半年) | 5-20GB |
| 大型MOD包 | 5-15GB |
| 插件和配置 | 100MB-1GB |
| 日志文件 | 500MB-5GB(需定期清理) |
| 备份文件 | 世界大小×备份数量 |

**推荐配置:**
- **最小:** 20GB SSD
- **推荐:** 50-100GB SSD + 大容量HDD(存备份)
- **理想:** 256GB+ NVMe SSD

### 4.4 网络带宽

**上传带宽需求计算:**

每个玩家占用带宽: 约0.1-0.5Mbps(平均0.2Mbps)

| 在线人数 | 最低带宽 | 推荐带宽 | 理想带宽 |
|---------|---------|---------|---------|
| 1-5人 | 1Mbps | 3Mbps | 5Mbps |
| 5-10人 | 2Mbps | 5Mbps | 10Mbps |
| 10-20人 | 4Mbps | 10Mbps | 20Mbps |
| 20-50人 | 10Mbps | 20Mbps | 50Mbps |
| 50-100人 | 20Mbps | 50Mbps | 100Mbps |

::: important
这里说的是**上传带宽**,不是下载带宽!家庭宽带通常上传很小(1-10Mbps),如果要开公开服务器,建议租用云服务器。
:::

**延迟(Ping)要求:**
- 优秀: <50ms
- 良好: 50-100ms
- 可接受: 100-150ms
- 较差: >150ms

## 5. 网络环境配置

### 5.1 端口映射(内网穿透)

**什么是端口映射?**

端口映射就是把你路由器的公网IP的某个端口"转发"到你电脑的内网IP的服务器端口上, 让外网玩家能够连接到你的服务器。

**家庭宽带开服的步骤:**

#### 第一步:查看本机IP

Windows:
```bash
ipconfig
```
找到"IPv4 地址", 如 `192.168.1.100`

Linux:
```bash
ip addr
```

#### 第二步:路由器端口映射

1. 浏览器输入路由器管理地址(通常是 `192.168.1.1` 或 `192.168.0.1`)
2. 登录路由器管理界面
3. 找到"端口转发"、"虚拟服务器"或"NAT设置"
4. 添加新规则:
   - 服务端口: 25565
   - 内部IP: 你的电脑IP(如192.168.1.100)
   - 内部端口: 25565
   - 协议: TCP
5. 保存并应用

#### 第三步:防火墙设置

**Windows防火墙:**

1. 控制面板 → Windows Defender 防火墙 → 高级设置
2. 入站规则 → 新建规则
3. 规则类型选择"端口"
4. 协议选择TCP, 端口填写25565
5. 允许连接
6. 全部配置文件勾选
7. 命名为"Minecraft Server"

**Linux防火墙(UFW):**

```bash
sudo ufw allow 25565/tcp
sudo ufw reload
```

#### 第四步:获取公网IP

访问网站: [https://www.ip.cn/](https://www.ip.cn/) 或 [https://ipinfo.io/](https://ipinfo.io/)

记下你的公网IP, 玩家使用这个IP连接你的服务器。

**⚠️ 家庭宽带的限制:**

1. **没有公网IP:** 很多地区运营商不再分配公网IP, 这种情况需要使用内网穿透工具
2. **动态IP:** 重启路由器后IP会变, 需要使用DDNS服务

### 5.2 内网穿透方案

当你没有公网IP时, 需要使用内网穿透工具:

**常用工具:**

| 工具名称 | 特点 | 适用场景 |
|---------|------|---------|
| Ngrok | 国外服务,速度慢 | 临时测试 |
| Frp | 需要有公网IP的服务器 | 自建穿透 |
| 樱花frp | 国内服务,免费套餐 | 小型服务器 |
| NATAPP | 稳定,有付费套餐 | 中小型服务器 |
| OpenFrp | 开源免费 | 测试使用 |

**SakuraFrp使用示例:**

1. 注册账号: [https://www.natfrp.com/](https://www.natfrp.com/)
2. 实名认证(免费用户也需要)
3. 下载客户端
4. 创建隧道:
   - 选择节点(选择离你近的)
   - 本地IP: 127.0.0.1
   - 本地端口: 25565
   - 远程端口: 自动分配
5. 启动客户端, 玩家使用分配的域名连接

::: note
如果长期运营, 建议直接租用云服务器, 比内网穿透更稳定。
:::

### 5.3 域名绑定(可选)

**为什么要用域名?**

域名比IP地址更容易记忆, 例如 `play.myserver.com` 比 `123.456.789.012:25565` 更专业。

**域名解析步骤:**

1. 购买域名(阿里云、腾讯云、Cloudflare等)
2. 添加A记录:
   - 主机记录: play (或其他子域名)
   - 记录类型: A
   - 记录值: 你的服务器IP
   - TTL: 600
3. 添加SRV记录(可选, 实现无端口连接):
   - 服务名称: `_minecraft._tcp`
   - 优先级: 0
   - 权重: 5
   - 端口: 25565
   - 目标: play.youromain.com

配置后, 玩家可以直接输入 `play.yourdomain.com` 连接, 无需输入端口。

## 6. 服务器核心类型

### 6.1 核心类型概述

Minecraft服务器核心就是服务器的"大脑", 不同的核心有不同的特性和用途。

**主流核心分类:**

| 核心名称 | 类型 | 特点 | 适用场景 |
|---------|------|------|---------|
| Vanilla | 官方原版 | 纯净,稳定,无插件 | 原版生存 |
| Bukkit | 插件服 | 最早的插件API(已停更) | 历史项目 |
| Spigot | 插件服 | Bukkit继任者, 优化好 | 通用插件服 |
| Paper | 插件服 | Spigot优化版, 性能最佳 | **推荐使用** |
| Purpur | 插件服 | Paper增强版, 更多配置项 | 高级用户 |
| Forge | MOD服 | MOD支持, 纯MOD无插件 | MOD整合包 |
| Fabric | MOD服 | 轻量MOD平台, 更新快 | 新版本MOD |
| Sponge | 混合服 | 同时支持Forge和插件 | MOD+插件 |
| Mohist | 混合服 | Forge+Bukkit插件 | MOD+插件 |
| Arclight | 混合服 | Forge+Bukkit, 更稳定 | MOD+插件 |

### 6.2 如何选择核心

**决策树:**

```
开服类型?
├─ 纯原版生存
│  └─ 使用 Vanilla(官方原版)
│
├─ 需要使用插件
│  ├─ 对性能要求高
│  │  └─ 使用 Paper ⭐推荐
│  ├─ 需要更多自定义选项
│  │  └─ 使用 Purpur
│  └─ 普通需求
│     └─ 使用 Spigot
│
├─ 需要使用MOD
│  ├─ 1.12.2及更早版本
│  │  └─ 使用 Forge
│  ├─ 1.14+新版本
│  │  └─ 使用 Fabric(轻量) 或 Forge(完整)
│  └─ MOD整合包
│     └─ 跟随整合包推荐的核心
│
└─ 同时需要MOD和插件
   ├─ 稳定性优先
   │  └─ 使用 Arclight
   └─ 兼容性优先
      └─ 使用 Mohist
```

### 6.3 核心下载渠道

**Paper (推荐):**
- 官网: [https://papermc.io/downloads](https://papermc.io/downloads)
- 特点: 更新快,性能优化好,兼容Spigot插件

**Spigot:**
- 官网: [https://www.spigotmc.org/](https://www.spigotmc.org/)
- 需要使用BuildTools编译(较复杂)
- 或从GetBukkit下载: [https://getbukkit.org/download/spigot](https://getbukkit.org/download/spigot)

**Purpur:**
- 官网: [https://purpurmc.org/downloads](https://purpurmc.org/downloads)
- 基于Paper,额外优化和功能

**Forge:**
- 官网: [https://files.minecraftforge.net/](https://files.minecraftforge.net/)
- 选择对应MC版本下载Installer

**Fabric:**
- 官网: [https://fabricmc.net/use/](https://fabricmc.net/use/)
- 下载Fabric Installer,自动安装

**Mohist/Arclight:**
- Mohist: [https://mohistmc.com/](https://mohistmc.com/)
- Arclight: [https://github.com/IzzelAliz/Arclight](https://github.com/IzzelAliz/Arclight)

### 6.4 核心安装

**插件核心(Paper/Spigot/Purpur)安装:**

1. 下载对应版本的JAR文件
2. 重命名为 `server.jar`(可选,方便管理)
3. 放入服务器文件夹
4. 首次启动会生成文件,然后自动关闭
5. 编辑 `eula.txt`,将 `eula=false` 改为 `eula=true`
6. 再次启动即可

**Forge安装:**

1. 下载Forge Installer
2. 运行安装程序,选择"Install Server"
3. 选择安装目录
4. 等待下载库文件完成
5. 使用生成的启动脚本启动服务器

**Fabric安装:**

1. 下载Fabric Installer
2. 选择"Server"标签
3. 选择MC版本和Fabric版本
4. 选择安装目录
5. 点击Install
6. 使用生成的JAR文件启动

## 7. 实战演示

### 7.1 Windows本地开服完整流程

#### 准备工作:

1. 创建服务器文件夹,如 `D:\MinecraftServer\`
2. 确保已安装正确版本的Java

#### 步骤一:下载核心

以Paper 1.20.4为例:

1. 访问 [https://papermc.io/downloads/paper](https://papermc.io/downloads/paper)
2. 选择1.20.4版本
3. 下载最新Build的JAR文件
4. 将下载的文件放入 `D:\MinecraftServer\`

#### 步骤二:创建启动脚本

在服务器文件夹创建 `start.bat` 文件,内容如下:

```batch
@echo off
title Minecraft Server
java -Xmx4G -Xms4G -jar paper-1.20.4-xxx.jar nogui
pause
```

**参数说明:**
- `@echo off`: 关闭命令回显
- `title`: 设置窗口标题
- `-Xmx4G -Xms4G`: 分配4GB内存
- `paper-1.20.4-xxx.jar`: 替换为你的核心文件名
- `nogui`: 不启动图形界面
- `pause`: 服务器关闭后暂停,方便查看错误信息

#### 步骤三:首次启动

1. 双击运行 `start.bat`
2. 等待文件生成,服务器会自动关闭
3. 打开 `eula.txt`,将 `eula=false` 改为 `eula=true`
4. 保存文件

#### 步骤四:配置服务器

编辑 `server.properties` 文件:

```properties
# 服务器端口(默认25565)
server-port=25565

# 游戏模式(survival/creative/adventure/spectator)
gamemode=survival

# 难度(peaceful/easy/normal/hard)
difficulty=normal

# 最大玩家数
max-players=20

# 视距(建议6-12)
view-distance=10

# 白名单(true/false)
white-list=false

# 在线模式(正版验证,true/false)
online-mode=true

# 服务器描述
motd=欢迎来到我的服务器!

# 世界种子(可选)
level-seed=

# 允许作弊(true/false)
allow-cheating=false
```

#### 步骤五:正式启动

1. 再次双击 `start.bat`
2. 等待显示 `Done!` 表示启动完成
3. 本地测试:打开MC客户端,多人游戏,添加服务器 `localhost`

#### 步骤六:端口映射(可选)

如果要让外网玩家连接,[参考第5章的端口映射教程](#_5-1-端口映射-内网穿透)。

### 7.2 Linux云服务器开服流程

#### 购买云服务器

推荐平台:
- 腾讯云轻量应用服务器(新用户优惠)
- 阿里云ECS
- 华为云
- Vultr / DigitalOcean(国外)

**配置建议:**
- 系统: Ubuntu 22.04 LTS
- CPU: 2核+
- 内存: 4GB+
- 带宽: 5Mbps+

#### 步骤一:连接服务器

**Windows用户使用PuTTY或Xshell:**

1. 下载并安装SSH客户端
2. 输入服务器IP
3. 端口22
4. 输入用户名root和密码

**macOS/Linux用户:**

```bash
ssh root@你的服务器IP
```

#### 步骤二:系统初始化

```bash
# 更新系统
apt update && apt upgrade -y

# 安装必要工具
apt install wget curl screen nano -y

# 安装Java 17
apt install openjdk-17-jre -y

# 验证Java安装
java -version
```

#### 步骤三:创建服务器用户

**安全建议:不要用root运行服务器**

```bash
# 创建专用用户
adduser minecraft

# 切换到该用户
su - minecraft

# 创建服务器目录
mkdir ~/server
cd ~/server
```

#### 步骤四:下载服务器核心

```bash
# 下载Paper 1.20.4(以最新版本为准)
wget https://api.papermc.io/v2/projects/paper/versions/1.20.4/builds/xxx/downloads/paper-1.20.4-xxx.jar

# 重命名
mv paper-1.20.4-xxx.jar server.jar
```

#### 步骤五:创建启动脚本

```bash
nano start.sh
```

输入以下内容:

```bash
#!/bin/bash
java -Xmx3G -Xms3G -jar server.jar nogui
```

保存(Ctrl+O,回车)并退出(Ctrl+X)

```bash
# 添加执行权限
chmod +x start.sh
```

#### 步骤六:首次启动

```bash
./start.sh
```

等待生成文件后,服务器会停止。

```bash
# 同意EULA
nano eula.txt
# 将false改为true,保存退出

# 修改服务器配置(可选)
nano server.properties
```

#### 步骤七:使用Screen后台运行

```bash
# 创建screen会话
screen -S minecraft

# 在screen中启动服务器
./start.sh

# 等待启动完成后,分离screen
# 按 Ctrl+A,然后按 D

# 查看screen列表
screen -ls

# 重新进入screen
screen -r minecraft
```

**常用Screen命令:**
- `screen -S 名称`: 创建新会话
- `screen -r 名称`: 恢复会话
- `Ctrl+A D`: 分离会话(服务器继续运行)
- `screen -ls`: 列出所有会话
- `exit`: 在screen内退出(会停止服务器)

#### 步骤八:配置防火墙

```bash
# 退出到root用户
exit

# 开放端口
ufw allow 25565/tcp

# 启用防火墙
ufw enable

# 查看状态
ufw status
```

#### 步骤九:设置开机自启(可选)

创建systemd服务:

```bash
nano /etc/systemd/system/minecraft.service
```

输入:

```ini
[Unit]
Description=Minecraft Server
After=network.target

[Service]
Type=simple
User=minecraft
WorkingDirectory=/home/minecraft/server
ExecStart=/usr/bin/java -Xmx3G -Xms3G -jar server.jar nogui
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启用服务:

```bash
systemctl daemon-reload
systemctl enable minecraft
systemctl start minecraft

# 查看状态
systemctl status minecraft

# 其他命令
# systemctl stop minecraft  (停止)
# systemctl restart minecraft  (重启)
```

### 7.3 Docker容器化部署(进阶)

Docker是一种容器技术,可以让服务器环境更加标准化和易于管理。

#### 安装Docker:

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# 启动Docker
systemctl start docker
systemctl enable docker
```

#### 使用Docker运行MC服务器:

```bash
# 创建数据目录
mkdir -p ~/minecraft-data

# 运行Paper服务器容器
docker run -d \
  --name minecraft \
  -p 25565:25565 \
  -v ~/minecraft-data:/data \
  -e EULA=TRUE \
  -e TYPE=PAPER \
  -e VERSION=1.20.4 \
  -e MEMORY=4G \
  --restart unless-stopped \
  itzg/minecraft-server
```

**参数说明:**
- `-d`: 后台运行
- `--name`: 容器名称
- `-p`: 端口映射
- `-v`: 数据卷挂载
- `-e EULA=TRUE`: 自动同意EULA
- `-e TYPE=PAPER`: 使用Paper核心
- `-e VERSION`: MC版本
- `-e MEMORY`: 内存分配
- `--restart`: 自动重启策略

**管理命令:**

```bash
# 查看日志
docker logs -f minecraft

# 停止服务器
docker stop minecraft

# 启动服务器
docker start minecraft

# 重启服务器
docker restart minecraft

# 进入控制台
docker attach minecraft
# (按Ctrl+P,Ctrl+Q退出而不停止)

# 删除容器
docker rm -f minecraft
```

## 8. 常见问题排查

### 8.1 服务器无法启动

#### 问题1: "Could not create the Java Virtual Machine"

**原因:** 内存分配过大或Java版本不匹配

**解决方案:**

1. 检查系统可用内存:

```bash
# Windows
systeminfo | findstr "可用的物理内存"

# Linux
free -h
```

2. 降低内存分配:

```bash
# 将 -Xmx4G -Xms4G 改为更小的值
java -Xmx2G -Xms2G -jar server.jar nogui
```

3. 检查Java版本:

```bash
java -version
```

确保版本匹配MC版本要求。

#### 问题2: "Unsupported class version error"

**原因:** Java版本过低

**错误示例:**
```
java.lang.UnsupportedClassVersionError: ... has been compiled by a more recent version of the Java Runtime
```

**解决方案:** 升级Java到要求的版本([参考2.2节](#_2-2-java版本选择指南))

#### 问题3: "Address already in use"

**原因:** 端口被占用

**解决方案:**

Windows查找占用进程:
```bash
netstat -ano | findstr 25565
taskkill /PID 进程号 /F
```

Linux查找占用进程:
```bash
netstat -tunlp | grep 25565
kill -9 进程号
```

或修改server.properties中的端口:
```properties
server-port=25566
```

### 8.2 性能问题

#### 问题1: 服务器卡顿,TPS低于20

**TPS是什么?**
TPS(Ticks Per Second)是服务器每秒运行的游戏刻数, 正常值为20。低于20表示服务器性能不足。

**诊断命令:**

在服务器控制台输入:
```
/tps
```

或使用Spark插件分析性能。

**常见原因和解决方案:**

1. **内存不足**

查看内存使用:
```
/gc
```

如果内存使用率>80%,增加分配的内存。

2. **区块加载过多**

在server.properties中:
```properties
view-distance=6  # 降低视距
simulation-distance=4  # 降低模拟距离
```

在paper.yml中:
```yaml
max-auto-save-chunks-per-tick: 12  # 降低自动保存压力
```

3. **过多的实体**

```
# 清理掉落物
/kill @e[type=item]

# 清理经验球
/kill @e[type=experience_orb]
```

安装ClearLag插件自动清理。

4. **红石机器过多**

使用WorldEdit等插件/模组工具检查并限制红石设备。

5. **插件冲突或低效插件**

使用Spark或Timings分析:
```
/spark profiler start
# 等待几分钟
/spark profiler stop
/spark profiler open
```

查看哪些插件占用资源最多, 优化或移除。

#### 问题2: 内存泄漏

**症状:** 服务器运行一段时间后内存持续增长, 最终崩溃

**解决方案:**

1. 使用G1GC垃圾回收器(Java 17+):

```bash
java -Xmx4G -Xms4G -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -jar server.jar nogui
```

2. 定期重启服务器(使用计划任务或插件)

3. 检查插件是否有内存泄漏, 更新到最新版本

### 8.3 连接问题

#### 问题1: "Connection refused" 或 "无法连接服务器"

**排查步骤:**

1. **检查服务器是否正在运行**

在服务器控制台输入:
```
list
```

如果有响应,说明服务器正常运行。

2. **检查防火墙**

Windows:
- 关闭防火墙测试
- 或添加例外规则([参考5.1节](#_5-1-端口映射-内网穿透))

Linux:
```bash
ufw status
ufw allow 25565/tcp
```

3. **检查端口映射**

确认路由器端口转发配置正确。

4. **检查IP地址**

```bash
# 查看公网IP
curl ifconfig.me
```

确保玩家使用的是正确的IP。

5. **测试本地连接**

在服务器所在电脑,使用客户端连接 `localhost`,如果能连接,说明问题在网络配置。

#### 问题2: "Authentication servers are down"

**原因:** 正版验证服务器连接失败

**解决方案:**

1. 检查网络连接
2. 等待Mojang服务器恢复
3. 临时方案:在server.properties中设置:
```properties
online-mode=false
```

::: warning
关闭online-mode会允许盗版(离线)玩家进入, 存在安全风险。

什么风险? 常见的一种攻击服务器的手段就是大量通过盗版登录方式进入服务器的假人进行压测攻击, 让服务器崩溃。
:::

#### 问题3: "Outdated client/server"

**原因:** 客户端和服务器版本不匹配

**解决方案:**

确保客户端和服务器使用相同的MC版本。可以使用ViaVersion等插件实现跨版本兼容。

### 8.4 权限和白名单问题

#### 设置OP权限:

```
/op 玩家名
/deop 玩家名
```

#### 启用白名单:

```properties
# server.properties
white-list=true
```

```
# 添加玩家到白名单
/whitelist add 玩家名

# 移除
/whitelist remove 玩家名

# 查看白名单
/whitelist list

# 重载白名单
/whitelist reload
```

### 8.5 数据损坏和恢复

#### 世界数据损坏:

**症状:** 区块丢失, 方块变成空气, 服务器崩溃

**恢复方法:**

1. **停止服务器**

2. **从备份恢复**

```bash
# 备份当前损坏的数据
mv world world_corrupted

# 恢复备份
cp -r backups/world_最新日期 world
```

3. **使用MCEdit修复区块**

下载MCEdit, 删除损坏的区块, 服务器会重新生成。

#### 玩家数据丢失:

**位置:** `world/playerdata/玩家UUID.dat`

**恢复方法:**

从备份中恢复对应的玩家数据文件。

**预防措施:**

1. **定期自动备份**

安装备份插件,如:
- SimpleBackup
- BackupManager
- WorldEdit(手动备份)

2. **使用脚本自动备份(Linux)**

```bash
nano backup.sh
```

```bash
#!/bin/bash
# 备份脚本
DATE=$(date +%Y%m%d-%H%M%S)
BACKUP_DIR="/home/minecraft/backups"
WORLD_DIR="/home/minecraft/server/world"

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/world-$DATE.tar.gz -C /home/minecraft/server world

# 保留最近7天的备份
find $BACKUP_DIR -name "world-*.tar.gz" -mtime +7 -delete

echo "Backup completed: world-$DATE.tar.gz"
```

```bash
chmod +x backup.sh

# 添加到crontab定时任务
crontab -e

# 每天凌晨3点备份
0 3 * * * /home/minecraft/backup.sh
```

## 总结

### 开服核心检查清单

**环境准备:**
- [ ] 安装正确版本的Java
- [ ] 配置Java环境变量
- [ ] 选择合适的操作系统
- [ ] 确保硬件满足要求

**服务器配置:**
- [ ] 下载合适的服务器核心
- [ ] 创建启动脚本
- [ ] 同意EULA协议
- [ ] 配置server.properties

**网络配置:**
- [ ] 设置端口映射(家庭宽带)
- [ ] 或使用内网穿透
- [ ] 或直接使用云服务器
- [ ] 配置防火墙规则

**安全和维护:**
- [ ] 设置白名单或权限插件
- [ ] 配置自动备份
- [ ] 安装必要的管理插件
- [ ] 制定服务器规则

### 推荐配置方案

:::: card-grid
::: card title="方案A - 新手测试服(预算0元):"
- 本机Windows系统
- 2-4GB内存分配
- Paper核心
- 樱花Frp内网穿透
- 适合: 3-5人朋友服
:::
::: card title="方案B - 小型服务器(预算50-100元/月):"
- 云服务器 2核4GB
- Ubuntu 22.04系统
- Paper核心 + 基础插件
- 5-10Mbps带宽
- 适合: 10-30人社区服
:::
::: card title="方案C - 中型服务器(预算200-500元/月):"
- 云服务器 4核8GB
- Ubuntu 22.04系统
- Paper/Purpur核心 + 丰富插件
- 10-30Mbps带宽
- 适合: 30-100人公开服
:::
:::card title="方案D - 大型服务器(预算1000+元/月):"
- 独立服务器 8核16GB+
- Linux系统
- 多服务器集群(BungeeCord)
- 100Mbps+带宽
- 专业运维团队
- 适合: 100+人大型网络服
:::
::::

### 你需要记住的

搭建和运营一个Minecraft服务器是一个持续学习的过程。本指南涵盖了运行环境的所有基础知识,但实际运营中你会遇到各种各样的新问题和挑战。

**记住以下原则:**

1. **从小做起:** 不要一开始就追求大型服务器, 先从朋友服开始积累经验
2. **持续学习:** 技术在不断更新, 保持学习新知识的态度
3. **备份至上:** 定期备份是保护数据的唯一方法
4. **社区互助:** 遇到问题多查阅文档, 多在社区提问(QQ/vx群也算社区的一部分)
5. **玩家第一:** 技术服务于体验, 始终以玩家体验为中心

祝你开服顺利!🎮

### 相关学习资源

1. **官方文档**:
    - Paper文档: [https://docs.papermc.io/](https://docs.papermc.io/)
    - Spigot文档: [https://www.spigotmc.org/wiki/](https://www.spigotmc.org/wiki/)
    - Minecraft Wiki: [https://zh.minecraft.wiki/](https://zh.minecraft.wiki/)

2. **社区论坛:**
    - MineBBS: [https://www.minebbs.com/](https://www.minebbs.com/)
    - SpigotMC Forums: [https://www.spigotmc.org/forums/](https://www.spigotmc.org/forums/)
    - SpigotMC Discord(需科学上网): [https://discord.gg/invite/spigotmc](https://discord.gg/invite/spigotmc)
    - PaperMC Forums: [https://forums.papermc.io/](https://forums.papermc.io/)
    - PaperMC Discord(需科学上网): [https://discord.gg/papermc](https://discord.gg/papermc)

3. **视频教程:**
    - B站搜索"[Minecraft服务器搭建](https://search.bilibili.com/all?keyword=Minecraft%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA)"
    - YouTube搜索"[Minecraft Server Setup](https://www.youtube.com/results?search_query=Minecraft+Server+Setup)"

4. **推荐工具:**
    - MCSManager(MCSM 服务器面板): [https://mcsmanager.com/](https://mcsmanager.com/)
    - Pterodactyl(翼龙 服务器面板): [https://pterodactyl.io/](https://pterodactyl.io/)